//==========================================================================
//==========================================================================
#include "mcu.h"

#include "ekz_misc.h"

//==========================================================================
// Defines
//==========================================================================

//==========================================================================
// LED
//==========================================================================
void Led0On (void)
{
    GPIOC_BRR = (1 << 13);
}

void Led0Off(void)
{
    GPIOC_BSRR = (1 << 13);
}

//==========================================================================
// USB Connect
//==========================================================================
void UsbConnect (void)
{
    GPIOA_BRR = (1 << 13);
}

void UsbDisconnect (void)
{
    GPIOA_BSRR = (1 << 13);
}

//==========================================================================
// IO Init
//==========================================================================
void IoInit(void)
{
    // Release AFIO/GPIO (A,B,C) reset
    RCC_APB2RSTR &= (~((1 << 0) | (1 << 2) | (1 << 3) | (1 << 4)));

    //Enable AFIO/GPIO (A,B,C) clock
    RCC_APB2ENR |= ((1 << 0) | (1 << 2) | (1 << 3) | (1 << 4));
    
    // Set GPIO Mode
    GPIOA_CRL = 0x44444444;
    GPIOA_CRH = 0x442444b4;
    GPIOB_CRL = 0x44444444;
    GPIOB_CRH = 0x44444444;
    GPIOC_CRL = 0x44444444;
    GPIOC_CRH = 0x44244444;

    // Disable JTAG/SW-DP
    AFIO_MAPR &= (~(0x07 << 24));
    AFIO_MAPR |=   (0x04 << 24);
}

